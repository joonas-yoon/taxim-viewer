{"version":3,"sources":["components/KakaoMap/MapLoader.tsx","components/KakaoMap/index.tsx","components/HorizontalContainer.tsx","components/Dot.tsx","components/Aside.tsx","providers/StatusProvider.tsx","components/IconButton.tsx","pages/Map/Controls/ViewerButtons.tsx","pages/Map/Timeline.tsx","pages/Map/colors.ts","pages/Map/ChatSide.tsx","pages/Map/Viewer.tsx","components/Point.tsx","pages/Map/Controls/EditorButtons.tsx","helpers/colors.ts","helpers/unionSet.ts","pages/Map/Editor.tsx","helpers/fileInteracts.ts","providers/ControlProvider.tsx","pages/Map/index.tsx","pages/App.tsx","reportWebVitals.ts","index.tsx"],"names":["Dimmer","styled","div","_templateObject","_taggedTemplateLiteral","MapLoader","props","_useInjectKakaoMapApi","useInjectKakaoMapApi","appkey","process","libraries","retries","loading","error","React","createElement","Fragment","Map","ContainerStyled","_ref","position","css","_templateObject2","_templateObject3","ContentStyled","_templateObject4","_ref2","gap","concat","Divider","MUIDivider","orientation","HorizontalContainer","_ref3","_ref3$gap","_ref3$style","style","children","paddleAnimation","keyframes","Circle","color","size","animate","Container","Dot","_ref3$color","_ref3$size","className","ContainerWrapper","fold","FoldButtonContainerStyled","FoldButtonStyled","_templateObject5","ref","_useState","useState","_useState2","_slicedToArray","setFold","ArrowIcon","useCallback","sx","width","fontSize","KeyboardDoubleArrowRightIcon","KeyboardDoubleArrowLeftIcon","onClick","evt","prev","Aside","forwardRef","initialState","currentTime","log","Context","createContext","undefined","StatusProvider","state","setState","Provider","value","_objectSpread","IconButton","_ref$tooltip","tooltip","_ref$tooltipColor","tooltipColor","_ref$tooltipPlacement","tooltipPlacement","_ref$tooltipSize","tooltipSize","active","_ref$disabled","disabled","_ref$loading","_ref$variant","variant","MuiTooltip","arrow","title","placement","MuiIconButton","--IconButton-size","CircularProgress","MenuButton","_ref$active","icon","PlaySpeedButton","speed","onSelectSpeed","_React$useState","_React$useState2","anchorEl","setAnchorEl","isOpen","Boolean","close","Item","item","MenuItem","Object","assign","selected","select","toFixed","event","currentTarget","SlowMotionVideoIcon","Menu","open","onClose","SliderWrapperStyled","ViewerButtons","running","runable","progressMax","progressCurrent","expanded","onProgressUpdated","onClickPlay","onClickExpand","PlayControlButton","PauseIcon","PlayArrowIcon","ExpandButton","KeyboardDoubleArrowDownIcon","KeyboardDoubleArrowUpIcon","Slider","aria-label","defaultValue","min","max","step","valueLabelDisplay","onChange","console","marginLeft","DEFAULT_TRACK_STYLE","Date","getTimezoneOffset","backgroundColor","borderRadius","boxShadow","trackStyleByStatus","status","opacity","createTracksByVehicle","vehicle_id","schedules","id","elements","map","load_time","start_time","task_id","unload_time","start","end","tracks","timedelta","date","delta","getTime","EmptyMessageStyled","Timeline","time","snapshot","setSnapshot","_useState3","current","_useState4","range","setRange","_useState5","_useState6","terminated","setTerminated","_useState7","getFullYear","_useState8","year","setYear","_useState9","getMonth","_useState10","month","setMonth","_useState11","getDay","_useState12","day","setDay","_useState13","getHours","_useState14","hour","setHour","_useState15","getMinutes","_useState16","minute","setMinute","stepable","minutes","startDate","curDate","toLocaleDateString","useEffect","getDate","url","axios","get","then","response","data","now","timebar","useMemo","COLUMNS","toLocaleTimeString","cells","_toConsumableArray","Array","_","index","useAsGrid","Result","logs","ExternalTimeline","scale","zoom","enableSticky","V_COLORS","WELCOME_MESSAGES","ChatContainerStyled","ChatTextFieldContainerStyled","ChatTextFieldStyled","input","ChatMessageStyled","direction","_ref4","_templateObject6","ChatMessage","_ref5","stackStyle","alignItems","isBot","Stack","Avatar","alt","src","outline","height","ChatInputContainer","_ref8","_ref8$controlledText","controlledText","onTextChange","onTextSend","send","text","length","type","placeholder","onKeyUp","code","target","SendRoundedIcon","ChatSide","_ref6","messages","messagesEndRef","useRef","scrollTo","scrollHeight","scrollToBottom","Action","_ref7","message","action","Button","marginTop","alert","justifyContent","spacing","minHeight","paddingTop","paddingBottom","boxSizing","from","key","MarkerType","LogIcon","isHover","setHover","display","justifyItems","onMouseOver","onMouseLeave","VehicleLogInfoStyled","RoadLineStyled","VehicleIconTooltipStyled","Icon","iconStyle","fill","LocalTaxiIcon","HailIcon","LogInfoStyled","get_slope_weight","x1","y1","x2","y2","cx","cy","lx","Math","abs","ly","dx","dy","r","sqrt","ViewerBottomFixedWrapperStyled","expand","ViewerButtonsClearStyled","TimelineWrapperStyled","_templateObject7","INITIAL_DATE","Viewer","markerPositions","setMarkerPositions","_useStatusState","ctx","useContext","Error","useStatusState","_useStatusState2","level","setLevel","setRunable","setRunning","setSpeed","progress","setProgress","_useState17","_useState18","elapsedMinutes","setElapsedMinutes","_useState19","_useState20","setLog","_useState21","_useState22","vehiclesState","setVehiclesState","_useState23","_useState24","displayTime","setDisplayTime","t","setTimeout","clearTimeout","timeShifted","_parseDate","second","getSeconds","logFull","useMap","getLevel","vehicles","tasks","vMarkers","name","lat","lng","tMarkers","pick_lat","pick_lng","drop_lat","drop_lng","flat","filter","newState","_i","_Array$from","vehicle","set","nameCollected","Set","v","newMap","_i2","_nameCollected","allocated_id","interval","DEFAULT_TIMESTEP","timer","fitMapBound","nodes","bounds","kakao","maps","LatLngBounds","forEach","_ref9","extend","LatLng","setBounds","focusTo","_ref10","panTo","LogItemVehicleWithTask","_ref11","vehicleTooltip","IconEmptyStyle","borderWidth","borderColor","borderStyle","justifySelf","borderTop","background","top","left","transition","zIndex","margin","_ref12","isPicked","isDroped","IconReadyStyle","IconNotReadyStyle","IconReadyInnerStyle","cursor","_useState25","_ref13","values","thisVehicle","thisTasks","_ref14","_useState26","isExpandTimeline","setExpanedTimeline","_useState27","_useState28","chatInput","setChatInput","_useState29","floor","random","_useState30","chatMessages","setChatMessages","addChatMessage","_ref15","CustomOverlayMap","cc","parentElement","i","post","res","_ref$color","Point","_ref4$size","_ref4$selected","onMouseEnter","onMouseDown","onMouseUp","data-id","EditorButtons","editMode","onModeChanged","onClickUpload","onClickDownload","onSelectMode","mode","ModeButtons","GrainIcon","PolylineIcon","OpenWithIcon","UploadButton","htmlFor","accept","UploadIcon","click","DownloadButton","DownloadIcon","arrayToHex","rgb","c","toString","padStart","join","shuffleArray","array","a","j","temp","UnionSet","_classCallCheck","this","parentIdx","_createClass","parent","president","find","b","ga","gb","keys","saveGraphFile","edges","json","keyToIndex","indexOf","transformed","info","to","filename","blob","document","download","href","URL","createObjectURL","dataset","downloadurl","addEventListener","e","revokeObjectURL","saveFile","toISOString","Blob","JSON","stringify","Editor","setNodes","bufNodes","_setBufNodes","setEdges","setEditMode","setSelected","cursorPos","setCursorPos","_visibleEdges","_setVisibleEdges","graphColors","setGraphColors","visibleEdges","edge","_edges","_step","_iterator","_createForOfIteratorHelper","s","n","done","err","f","_step2","union","_iterator2","merge","_step3","colorMap","groupColors","_iterator3","round","_step4","_iterator4","getMapBounds","getBounds","getNorthEast","getSouthWest","ne","sw","getLat","getLng","bottom","right","setTmpNodes","newNodes","_getMapBounds","nodesInGrid","grid","compressNodesInGrid","isSelected","selectedNode","node","findNode","_step5","_iterator5","getNode","isNodeVisible","result","relayout","hasNode","_selected","fromID","toID","createEdge","onMapClick","loc","latLng","nodeId","slice","onMapMouseUp","onMapMouseMove","updateNodes","addListener","setCursor","removeListener","onMouseDownPoint","container","closest","getAttribute","mouseType","button","onMouseUpPoint","guideLine","Polyline","path","strokeWeight","strokeColor","strokeOpacity","strokeStyle","NodePoints","_ref16","EdgeLines","_ref17","_ref18","_ref19","loadGraphFromFile","files","file","reader","FileReader","_JSON$parse","parse","_ref20","_ref21","_unused","window","readAsText","downloadGraphToFile","viewSpeed","viewRunning","ControlProvider","useControlState","SwitchButton","startDecorator","borderTopRightRadius","borderBottomRightRadius","CableIcon","borderTopLeftRadius","borderBottomLeftRadius","_useControlState","_useControlState2","controls","setControls","SwitchButtonControlled","padding","KakaoMap","center","onZoomChanged","App","reportWebVitals","onPerfEntry","Function","__webpack_require__","bind","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","createRoot","getElementById","render"],"mappings":"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","file":"static/js/main.8b9a6e76.chunk.js","sourcesContent":["import React, { useEffect } from \"react\"\n\nimport KakaoMapSDK, {\n  Map,\n  useInjectKakaoMapApi,\n  useMap,\n} from \"react-kakao-maps-sdk\"\nimport styled from \"styled-components\"\n\ntype MapProps = KakaoMapSDK.MapProps & {\n  style?: React.CSSProperties\n}\n\nconst Dimmer = styled.div`\n  overflow: hidden;\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n  background: rgb(0, 0, 0, 0.5);\n  backdrop-filter: blur(5px);\n`\n\nexport default function MapLoader(props: MapProps): React.ReactElement {\n  const { loading, error } = useInjectKakaoMapApi({\n    appkey: process.env.REACT_APP_KAKAO_MAP_API_KEY as string,\n    libraries: [\"services\", \"clusterer\"],\n    retries: 3,\n  })\n  return (\n    <>\n      {loading || error ? (\n        <Dimmer />\n      ) : (\n        <Map {...(props as KakaoMapSDK.MapProps)} />\n      )}\n    </>\n  )\n}\n","import MapLoader from \"./MapLoader\"\n\nexport default MapLoader\n","import React from \"react\"\nimport MUIDivider from \"@mui/joy/Divider\"\nimport styled, { css } from \"styled-components\"\n\nconst ContainerStyled = styled.div<{ position: \"top\" | \"bottom\" }>`\n  position: absolute;\n  display: flex;\n  left: calc(0px + 50%);\n  translate: -50% 0%;\n  margin: 0 auto;\n  width: fit-content;\n  height: 42px;\n  place-items: center;\n  padding: 6px;\n  background: white;\n  border-radius: 8px;\n  box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 1em;\n  box-sizing: border-box;\n\n  ${({ position }: any) =>\n    position == \"top\"\n      ? css`\n          top: 1rem;\n        `\n      : css`\n          bottom: 1rem;\n        `}\n`\n\nconst ContentStyled = styled.div<{ gap: number }>`\n  display: flex;\n  flex-direction: row;\n  gap: ${({ gap }: any) => `${gap}rem`};\n  margin: 0px auto;\n  place-items: center;\n  box-sizing: border-box;\n`\n\ntype ContainerProps = React.PropsWithChildren & {\n  position: \"top\" | \"bottom\"\n  gap?: number\n  style?: React.CSSProperties\n}\n\nconst HorizontalContainer = ({\n  position,\n  gap = 0.5,\n  style = {},\n  children,\n}: ContainerProps): React.ReactElement => (\n  <ContainerStyled position={position} style={style}>\n    <ContentStyled gap={gap}>{children}</ContentStyled>\n  </ContainerStyled>\n)\n\nexport const Divider = (): React.ReactElement => (\n  <MUIDivider orientation=\"vertical\" />\n)\n\nexport default HorizontalContainer\n","import React from \"react\"\nimport styled, { css, keyframes } from \"styled-components\"\n\nconst paddleAnimation = keyframes`\n  from {\n    transform: scale(1.0);\n    opacity: 1.0;\n  }\n  to {\n    transform: scale(2.0);\n    opacity: 0.0;\n  }\n`\n\ntype CircleStyleProps = {\n  size: number\n  color: string\n  animate?: boolean\n  children?: React.ReactNode | React.ReactNode[]\n}\n\nconst Circle = styled.div`\n  position: absolute;\n  display: flex;\n  width: 1em;\n  height: 1em;\n  background: ${({ color }: CircleStyleProps) => color};\n  border-radius: 8rem;\n  align-items: center;\n  justify-content: center;\n  scale: ${({ size }: CircleStyleProps) => size};\n\n  ${(props: CircleStyleProps) =>\n    props.animate &&\n    css`\n      animation: ${paddleAnimation} 1s ease-in-out infinite;\n    `};\n\n  > .icon {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n`\n\nconst Container = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n`\n\ntype DotProps = {\n  color?: string\n  size?: number\n  children?: React.ReactNode | React.ReactNode[]\n}\n\nconst Dot = ({ color = \"dodgerblue\", size = 2, children }: DotProps) => {\n  return (\n    <Container>\n      <Circle color={color} size={size} animate={true} />\n      <Circle color={color} size={size}>\n        <div className=\"icon\">{children}</div>\n      </Circle>\n    </Container>\n  )\n}\n\nexport default Dot\n","import React, { useState, useCallback, PropsWithChildren } from \"react\"\n\nimport styled, { css, keyframes } from \"styled-components\"\n\nimport KeyboardDoubleArrowLeftIcon from \"@mui/icons-material/KeyboardDoubleArrowLeft\"\nimport KeyboardDoubleArrowRightIcon from \"@mui/icons-material/KeyboardDoubleArrowRight\"\n\nconst ContainerWrapper = styled.div<{ fold: boolean }>`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  max-width: 280px;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-items: center;\n  transition: transform 400ms cubic-bezier(0.65, 0.05, 0.36, 1);\n  z-index: 99999;\n\n  ${({ fold }: any) =>\n    fold &&\n    css`\n      transform: translateX(-100%);\n    `}\n`\n\nconst ContainerStyled = styled.div`\n  position: relative;\n  width: 100%;\n  height: 100%;\n  background-color: #ffffff;\n  border: 0;\n  border-radius: 0;\n  outline: 0;\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n  box-shadow: 0 0 1em rgba(128, 128, 128, 0.5);\n  overflow-y: auto;\n  &::-webkit-scrollbar {\n    display: none;\n  }\n`\n\nconst FoldButtonContainerStyled = styled.div`\n  position: absolute;\n  display: flex;\n  width: 1.25em;\n  height: 100%;\n  right: -1.25em;\n  justify-content: center;\n  align-items: center;\n`\n\nconst FoldButtonStyled = styled.div`\n  width: 100%;\n  height: 3em;\n  display: flex;\n  padding: 0 2px;\n  justify-content: center;\n  align-items: center;\n  box-sizing: border-box;\n  background-color: #ffffff;\n  border-top-right-radius: 5px;\n  border-bottom-right-radius: 5px;\n  clip-path: inset(-1em -1em -1em 0px);\n  box-shadow: 0 0 1em rgba(128, 128, 128, 0.5);\n  cursor: pointer;\n`\n\ntype ContainerProps = {\n  _ref: React.ForwardedRef<any>\n  children?: React.ReactNode\n}\n\nconst Container = ({\n  _ref: ref,\n  children,\n}: ContainerProps): React.ReactElement => {\n  const [fold, setFold] = useState<boolean>(true)\n  const ArrowIcon = useCallback(() => {\n    const props = {\n      sx: {\n        width: \"100%\",\n        fontSize: \"1rem\",\n      },\n    }\n    return fold ? (\n      <KeyboardDoubleArrowRightIcon {...props} />\n    ) : (\n      <KeyboardDoubleArrowLeftIcon {...props} />\n    )\n  }, [fold])\n  return (\n    <ContainerWrapper fold={fold}>\n      <ContainerStyled ref={ref}>\n        <>{children}</>\n      </ContainerStyled>\n      <FoldButtonContainerStyled>\n        <FoldButtonStyled\n          onClick={(evt) => {\n            setFold((prev) => !prev)\n          }}\n        >\n          <ArrowIcon />\n        </FoldButtonStyled>\n      </FoldButtonContainerStyled>\n    </ContainerWrapper>\n  )\n}\n\nconst Aside = React.forwardRef((props: PropsWithChildren, ref) => (\n  <Container _ref={ref}>\n    <>{props.children}</>\n  </Container>\n))\n\nexport default Aside\n","import React, { createContext, useState, useContext } from \"react\"\n\nexport interface ContextState<T> {\n  state: T\n  setState: React.Dispatch<React.SetStateAction<T>>\n}\n\nexport type LogFullType = {\n  time: number\n  vehicles: Array<{\n    name: string\n    lat: number\n    lng: number\n    status: number\n    allocated_id: number\n  }>\n  tasks: Array<{\n    id: number\n    pick_lat: number\n    pick_lng: number\n    drop_lat: number\n    drop_lng: number\n    time: number\n    status: number\n  }>\n}\n\nexport interface StatusState {\n  currentTime: number | null\n  log: LogFullType | null\n}\n\nconst initialState: StatusState = {\n  currentTime: null,\n  log: null,\n}\n\nconst Context: any = createContext<ContextState<StatusState> | undefined>(\n  undefined\n)\n\nexport const StatusProvider = (props: any) => {\n  const [state, setState] = useState<StatusState>(initialState)\n\n  return (\n    <Context.Provider value={{ state: { ...state }, setState }}>\n      <>{props.children}</>\n    </Context.Provider>\n  )\n}\n\nexport const useStatusState = (): [\n  StatusState,\n  React.Dispatch<React.SetStateAction<StatusState>>\n] => {\n  const ctx: ContextState<StatusState> | undefined = useContext(Context)\n  if (ctx === undefined) {\n    throw new Error(\"useStatusState should be used within StatusProvider\")\n  }\n  const { state, setState } = ctx\n  return [\n    state as StatusState,\n    setState as React.Dispatch<React.SetStateAction<StatusState>>,\n  ]\n}\n","import React, { useCallback } from \"react\"\n\nimport MuiIconButton from \"@mui/joy/IconButton\"\nimport MuiTooltip from \"@mui/joy/Tooltip\"\nimport CircularProgress from \"@mui/joy/CircularProgress\"\n\ntype IconButtonProps = React.PropsWithChildren & {\n  tooltip?: React.ReactNode\n  tooltipColor:\n    | \"primary\"\n    | \"neutral\"\n    | \"danger\"\n    | \"info\"\n    | \"success\"\n    | \"warning\"\n  tooltipPlacement?:\n    | \"bottom\"\n    | \"left\"\n    | \"right\"\n    | \"top\"\n    | \"bottom-end\"\n    | \"bottom-start\"\n    | \"left-end\"\n    | \"left-start\"\n    | \"right-end\"\n    | \"right-start\"\n    | \"top-end\"\n    | \"top-start\"\n  tooltipSize?: \"sm\" | \"md\" | \"lg\"\n  active: boolean\n  disabled?: boolean\n  loading?: boolean\n  variant?: \"plain\" | \"outlined\" | \"soft\" | \"solid\"\n  size: string\n  onClick: (event: React.MouseEvent<HTMLElement>) => void\n}\n\nconst IconButton = ({\n  tooltip = undefined,\n  tooltipColor = \"primary\",\n  tooltipPlacement = \"bottom\",\n  tooltipSize = \"sm\",\n  active,\n  disabled = false,\n  loading = false,\n  variant = \"plain\",\n  size,\n  onClick,\n  children,\n}: IconButtonProps) => {\n  return (\n    <MuiTooltip\n      arrow\n      title={tooltip}\n      color={tooltipColor}\n      placement={tooltipPlacement}\n      size={tooltipSize}\n      variant={variant}\n    >\n      <MuiIconButton\n        variant={active ? \"solid\" : \"soft\"}\n        sx={{\n          \"--IconButton-size\": size,\n        }}\n        disabled={disabled}\n        onClick={onClick}\n      >\n        {loading ? (\n          <CircularProgress\n            color=\"primary\"\n            size=\"sm\"\n            value={33}\n            variant=\"plain\"\n          />\n        ) : (\n          children\n        )}\n      </MuiIconButton>\n    </MuiTooltip>\n  )\n}\n\nexport default IconButton\n","import React, { useState, useCallback, useRef, useEffect } from \"react\"\n\nimport { Slider, Menu, MenuItem } from \"@mui/joy\"\nimport PlayArrowIcon from \"@mui/icons-material/PlayArrow\"\nimport PauseIcon from \"@mui/icons-material/Pause\"\nimport KeyboardDoubleArrowUpIcon from \"@mui/icons-material/KeyboardDoubleArrowUp\"\nimport KeyboardDoubleArrowDownIcon from \"@mui/icons-material/KeyboardDoubleArrowDown\"\n\nimport IconButton from \"../../../components/IconButton\"\nimport SlowMotionVideoIcon from \"@mui/icons-material/SlowMotionVideo\"\nimport HorizontalContainer, {\n  Divider,\n} from \"../../../components/HorizontalContainer\"\nimport styled from \"styled-components\"\n\ntype MenuButtonProps = {\n  title?: string\n  active?: boolean\n  disabled?: boolean\n  loading?: boolean\n  icon: React.ReactElement\n  onClick: (event: React.MouseEvent<HTMLElement>) => void\n}\n\nconst MenuButton = ({\n  title,\n  active = false,\n  disabled = false,\n  loading = false,\n  icon,\n  onClick,\n}: MenuButtonProps) => {\n  return (\n    <IconButton\n      tooltip={title}\n      tooltipColor=\"primary\"\n      tooltipPlacement=\"top\"\n      active={active}\n      disabled={disabled}\n      loading={loading}\n      variant=\"outlined\"\n      size={\"32px\"}\n      onClick={onClick}\n    >\n      {icon}\n    </IconButton>\n  )\n}\n\ntype SpeedControlProps = {\n  speed: number\n  onSelectSpeed: (speed: number) => void\n}\n\nconst PlaySpeedButton = ({\n  speed,\n  onSelectSpeed,\n}: SpeedControlProps): React.ReactElement => {\n  const [anchorEl, setAnchorEl] = React.useState(null)\n  const isOpen = Boolean(anchorEl)\n  const handleClick = (event: React.SyntheticEvent<any>) => {\n    setAnchorEl(event.currentTarget)\n  }\n  const close = () => {\n    setAnchorEl(null)\n  }\n  const select = (item: number) => {\n    onSelectSpeed(item)\n    close()\n  }\n\n  const Item = useCallback(\n    (item: number): React.ReactElement => (\n      <MenuItem\n        {...(speed === item && { selected: true, variant: \"soft\" })}\n        onClick={() => select(item)}\n      >\n        x{item.toFixed(1)}\n      </MenuItem>\n    ),\n    [speed]\n  )\n\n  return (\n    <div>\n      <MenuButton\n        title={isOpen ? undefined : \"재생 속도\"}\n        onClick={handleClick}\n        icon={<SlowMotionVideoIcon />}\n      />\n      <Menu\n        anchorEl={anchorEl}\n        open={isOpen}\n        onClose={close}\n        color=\"primary\"\n        size=\"sm\"\n        variant=\"plain\"\n      >\n        {Item(1.0)}\n        {Item(2.0)}\n        {Item(5.0)}\n        {Item(10.0)}\n      </Menu>\n    </div>\n  )\n}\n\nconst SliderWrapperStyled = styled.div`\n  width: calc(100vw - 600px);\n  width: calc(100svw - 600px);\n  max-width: 480px;\n  padding-left: 0.5rem;\n  padding-right: 1rem;\n  box-sizing: border-box;\n`\n\ntype ViewerButtonsProps = {\n  running: boolean\n  runable: boolean\n  progressMax: number\n  progressCurrent: number\n  expanded: boolean\n  onProgressUpdated: (progress: number) => void\n  onClickPlay: () => void\n  onClickExpand: (expand: boolean) => void\n} & SpeedControlProps\n\nconst ViewerButtons = ({\n  running,\n  runable,\n  progressMax,\n  progressCurrent,\n  speed,\n  expanded,\n  onSelectSpeed,\n  onProgressUpdated,\n  onClickPlay,\n  onClickExpand,\n}: ViewerButtonsProps): React.ReactElement => {\n  const PlayControlButton = useCallback((): React.ReactElement => {\n    return running ? (\n      <MenuButton title=\"일시정지\" onClick={onClickPlay} icon={<PauseIcon />} />\n    ) : (\n      <MenuButton\n        title=\"재생\"\n        disabled={!runable}\n        onClick={onClickPlay}\n        icon={<PlayArrowIcon />}\n      />\n    )\n  }, [running, runable])\n\n  const ExpandButton = useCallback((): React.ReactElement => {\n    return (\n      <>\n        <MenuButton\n          title={expanded ? \"닫기\" : \"자세히 보기\"}\n          icon={\n            expanded ? (\n              <KeyboardDoubleArrowDownIcon />\n            ) : (\n              <KeyboardDoubleArrowUpIcon />\n            )\n          }\n          onClick={() => {\n            onClickExpand(!expanded)\n          }}\n        />\n      </>\n    )\n  }, [expanded, onClickExpand])\n\n  return (\n    <>\n      <HorizontalContainer position=\"bottom\">\n        <PlayControlButton />\n        <PlaySpeedButton speed={speed} onSelectSpeed={onSelectSpeed} />\n        <Divider />\n        <SliderWrapperStyled>\n          <Slider\n            color=\"primary\"\n            aria-label=\"Timestamp\"\n            defaultValue={0}\n            value={progressCurrent}\n            min={0}\n            max={progressMax}\n            step={1}\n            disabled={!runable || running}\n            size=\"md\"\n            valueLabelDisplay=\"off\"\n            variant=\"solid\"\n            onChange={(\n              event: React.SyntheticEvent | Event,\n              value: number | number[]\n            ) => {\n              console.log(\"new value\", value)\n              if (typeof value === \"number\") {\n                onProgressUpdated(value)\n              } else {\n                onProgressUpdated(value[0])\n              }\n            }}\n            style={{\n              width: \"calc(100% - 0.5rem)\",\n              marginLeft: \"0.5rem\",\n            }}\n          />\n        </SliderWrapperStyled>\n        <Divider />\n        <ExpandButton />\n      </HorizontalContainer>\n    </>\n  )\n}\n\nexport default ViewerButtons\n","import React, {\n  useCallback,\n  useState,\n  useEffect,\n  CSSProperties,\n  useMemo,\n} from \"react\"\n// @ts-ignore\nimport ExternalTimeline from \"react-timelines\"\nimport styled from \"styled-components\"\nimport \"react-timelines/lib/css/style.css\"\nimport \"./timeline-overrides.css\"\nimport axios from \"axios\"\n\nconst SERVER_HOST = process.env.REACT_APP_SERVER_HOST as string\nconst TIMEZONE_OFFSET = new Date().getTimezoneOffset() * 60 * 1000\nconst COLUMN_GAP = 10 * 60 * 1000 // 10 min\n\ntype ServerScheduleTimeType = {\n  load_time: string\n  start_time: string\n  status: number\n  task_id: number\n  unload_time: string\n}\n\ntype ServerSnapshotLogType = {\n  vehicle_id: string\n  schedules: Array<ServerScheduleTimeType>\n}\n\ntype SnapshotType = {\n  time: number\n  logs: ServerSnapshotLogType[]\n}\n\nconst DEFAULT_TRACK_STYLE: CSSProperties = {\n  backgroundColor: \"#dcdc33\",\n  color: \"#1f1f1f\",\n  borderRadius: \"4px\",\n  boxShadow: \"1px 1px 0px rgba(0, 0, 0, 0.25)\",\n}\n\nconst STATUS_FINISHED = 0\nconst STATUS_WORKING = 1\nconst STATUS_WAITING = 2\n\nconst trackStyleByStatus = (status: number): CSSProperties => {\n  if (status === STATUS_FINISHED) {\n    return {\n      color: \"white\",\n      backgroundColor: \"gray\",\n      opacity: 0.5,\n    }\n  }\n  if (status === STATUS_WORKING) {\n    return {\n      color: \"white\",\n      backgroundColor: \"#0a6bde\",\n    }\n  }\n  if (status === STATUS_WAITING) {\n    return {\n      color: \"white\",\n      backgroundColor: \"#dcdc33\",\n    }\n  }\n  return {}\n}\n\nconst createTracksByVehicle = ({\n  vehicle_id,\n  schedules,\n}: ServerSnapshotLogType) => {\n  return {\n    id: `tracks-for-${vehicle_id}`,\n    title: vehicle_id,\n    elements: schedules.map(\n      ({\n        load_time,\n        start_time,\n        status,\n        task_id,\n        unload_time,\n      }: ServerScheduleTimeType) => ({\n        id: `${vehicle_id}-track-${task_id}`,\n        title: `#${task_id}`,\n        start: new Date(start_time),\n        end: new Date(unload_time),\n        style: { ...DEFAULT_TRACK_STYLE, ...trackStyleByStatus(status) },\n      })\n    ),\n    tracks: [],\n  }\n}\n\ntype TimeRange = {\n  start: Date\n  current: Date\n  end: Date\n}\n\nconst timedelta = (date: Date, delta: number): Date =>\n  new Date(date.getTime() + delta)\n\nconst EmptyMessageStyled = styled.div`\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  color: #9f9f9f;\n`\n\ntype TimelineProps = {\n  time: Date\n}\n\nconst Timeline = ({ time }: TimelineProps) => {\n  const [snapshot, setSnapshot] = useState<SnapshotType>()\n  const [range, setRange] = useState<TimeRange>({\n    start: new Date(),\n    current: new Date(),\n    end: new Date(),\n  })\n  const [terminated, setTerminated] = useState<boolean>(false)\n  const [year, setYear] = useState<number>(time.getFullYear())\n  const [month, setMonth] = useState<number>(time.getMonth() + 1)\n  const [day, setDay] = useState<number>(time.getDay())\n  const [hour, setHour] = useState<number>(time.getHours())\n  const [minute, setMinute] = useState<number>(time.getMinutes())\n\n  const stepable = useCallback(\n    (minutes: number): boolean => {\n      const startDate = new Date(year, month - 1, day)\n      const curDate = timedelta(startDate, minutes * 60 * 1000)\n      return startDate.toLocaleDateString() == curDate.toLocaleDateString()\n    },\n    [year, month, day]\n  )\n\n  useEffect(() => {\n    console.log(\"Timeline time changed\", time)\n    setYear(time.getFullYear())\n    setMonth(time.getMonth() + 1)\n    setDay(time.getDate())\n    setHour(time.getHours())\n    setMinute(time.getMinutes())\n  }, [time])\n\n  useEffect(() => {\n    setTerminated(!stepable(minute))\n  }, [minute])\n\n  useEffect(() => {\n    if (terminated) return\n    console.log(\"Request schedule\")\n    const vehicles = 10\n    const tasks = 130\n    const url = `${SERVER_HOST}/schedule/${year}/${month}/${day}/${hour}/${minute}?vehicles=${vehicles}&tasks=${tasks}`\n    axios.get(url).then((response) => {\n      setSnapshot(response.data as SnapshotType)\n    })\n  }, [year, month, day, hour, minute, terminated])\n\n  useEffect(() => {\n    console.log(\"snapshot\", snapshot)\n    if (!snapshot || !snapshot.time) {\n      setTerminated(true)\n      return\n    }\n    const now = new Date(snapshot.time)\n    setRange({\n      start: timedelta(now, -3 * 3600 * 1000),\n      current: now,\n      end: timedelta(now, 9 * 3600 * 1000),\n    })\n    setTerminated(false)\n  }, [snapshot])\n\n  const timebar = useMemo(() => {\n    const { start, current, end } = range\n    const COLUMNS = (end.getTime() - start.getTime()) / COLUMN_GAP\n    console.log(\"start\", start)\n    console.log(\"end\", end)\n\n    return [\n      {\n        id: \"minutes\",\n        title: current.toLocaleTimeString(),\n        cells: [...Array(COLUMNS)].map((_, index) => {\n          const time = timedelta(start, COLUMN_GAP * index)\n          const end = timedelta(time, COLUMN_GAP)\n          const minute = time.getMinutes()\n          return {\n            id: `header-m-${time.getTime()}`,\n            title: \"\",\n            start: time,\n            end,\n            style:\n              minute == current.getMinutes()\n                ? {\n                    backgroundColor: \"black\",\n                  }\n                : {},\n          }\n        }),\n        useAsGrid: true,\n        style: {},\n      },\n    ]\n  }, [range])\n\n  const Result = useCallback(\n    () =>\n      snapshot && snapshot.logs ? (\n        <ExternalTimeline\n          scale={{\n            start: range.start,\n            end: range.end,\n            zoom: 11,\n          }}\n          timebar={timebar}\n          tracks={snapshot.logs.map(createTracksByVehicle)}\n          now={range.current}\n          enableSticky\n        />\n      ) : (\n        <EmptyMessageStyled>No Data</EmptyMessageStyled>\n      ),\n    [snapshot, timebar]\n  )\n\n  return <Result />\n}\n\nexport default Timeline\n","export const V_COLORS = new Map([\n  [\"V0\", \"#f83cbd\"],\n  [\"V1\", \"#7f209c\"],\n  [\"V2\", \"#3d9630\"],\n  [\"V3\", \"#1dfd57\"],\n  [\"V4\", \"#0a748c\"],\n  [\"V5\", \"#fc193f\"],\n  [\"V6\", \"#188552\"],\n  [\"V7\", \"#7129aa\"],\n  [\"V8\", \"#713fbd\"],\n  [\"V9\", \"#942122\"],\n  [\"V10\", \"#652b94\"],\n  [\"V11\", \"#a61109\"],\n  [\"V12\", \"#32f53b\"],\n  [\"V13\", \"#9f171a\"],\n  [\"V14\", \"#43f02a\"],\n  [\"V15\", \"#a52b5f\"],\n  [\"V16\", \"#b03929\"],\n  [\"V17\", \"#810c76\"],\n  [\"V18\", \"#326f8d\"],\n  [\"V19\", \"#1efd90\"],\n  [\"V20\", \"#9f5c17\"],\n  [\"V21\", \"#18921e\"],\n  [\"V22\", \"#00f7aa\"],\n  [\"V23\", \"#ac2905\"],\n  [\"V24\", \"#837822\"],\n  [\"V25\", \"#20812d\"],\n  [\"V26\", \"#8b1a5e\"],\n  [\"V27\", \"#b55c1d\"],\n  [\"V28\", \"#2076b0\"],\n  [\"V29\", \"#975a26\"],\n  [\"V30\", \"#937213\"],\n  [\"V31\", \"#842156\"],\n  [\"V32\", \"#9c6d36\"],\n  [\"V33\", \"#6cb822\"],\n  [\"V34\", \"#25be30\"],\n  [\"V35\", \"#3b9b41\"],\n  [\"V36\", \"#02b65a\"],\n  [\"V37\", \"#7eb13f\"],\n  [\"V38\", \"#827409\"],\n  [\"V39\", \"#403cbc\"],\n  [\"V40\", \"#255481\"],\n  [\"V41\", \"#70ae06\"],\n  [\"V42\", \"#409f51\"],\n  [\"V43\", \"#202aa9\"],\n  [\"V44\", \"#33811d\"],\n  [\"V45\", \"#0c8439\"],\n  [\"V46\", \"#8b3407\"],\n  [\"V47\", \"#b04060\"],\n  [\"V48\", \"#4738ad\"],\n  [\"V49\", \"#a9511a\"],\n  [\"V50\", \"#438100\"],\n  [\"V51\", \"#ba1f39\"],\n  [\"V52\", \"#90237f\"],\n  [\"V53\", \"#7315a0\"],\n  [\"V54\", \"#03941c\"],\n  [\"V55\", \"#32a647\"],\n  [\"V56\", \"#b2742c\"],\n  [\"V57\", \"#9f2f15\"],\n  [\"V58\", \"#925218\"],\n  [\"V59\", \"#1226b5\"],\n  [\"V60\", \"#921b35\"],\n  [\"V61\", \"#3a1a8e\"],\n  [\"V62\", \"#23810e\"],\n  [\"V63\", \"#572998\"],\n  [\"V64\", \"#1c18bb\"],\n  [\"V65\", \"#a06f1c\"],\n  [\"V66\", \"#b01364\"],\n  [\"V67\", \"#46ac02\"],\n  [\"V68\", \"#ac2329\"],\n  [\"V69\", \"#a26423\"],\n  [\"V70\", \"#3f8b1a\"],\n  [\"V71\", \"#8a5b2e\"],\n  [\"V72\", \"#453c8f\"],\n  [\"V73\", \"#98283a\"],\n  [\"V74\", \"#b83314\"],\n  [\"V75\", \"#313fab\"],\n  [\"V76\", \"#3db578\"],\n  [\"V77\", \"#1c3fbf\"],\n  [\"V78\", \"#403580\"],\n  [\"V79\", \"#2d619d\"],\n  [\"V80\", \"#336c84\"],\n  [\"V81\", \"#8c0f12\"],\n  [\"V82\", \"#3e0ca6\"],\n  [\"V83\", \"#66a62a\"],\n  [\"V84\", \"#a62069\"],\n  [\"V85\", \"#283dab\"],\n  [\"V86\", \"#ae2779\"],\n  [\"V87\", \"#8f0961\"],\n  [\"V88\", \"#ab7737\"],\n  [\"V89\", \"#b7171f\"],\n  [\"V90\", \"#c00129\"],\n  [\"V91\", \"#1b05a2\"],\n  [\"V92\", \"#219514\"],\n  [\"V93\", \"#2e9d51\"],\n  [\"V94\", \"#7b2481\"],\n  [\"V95\", \"#215b87\"],\n  [\"V96\", \"#6e07a4\"],\n  [\"V97\", \"#49ab04\"],\n  [\"V98\", \"#10a772\"],\n  [\"V99\", \"#ae2d52\"],\n])\n","import React, { useCallback, useEffect, useRef } from \"react\"\nimport styled, { css } from \"styled-components\"\nimport { Stack } from \"@mui/joy\"\nimport Avatar from \"@mui/joy/Avatar\"\nimport Button from \"@mui/joy/Button\"\nimport IconButton from \"@mui/joy/IconButton\"\nimport SendRoundedIcon from \"@mui/icons-material/SendRounded\"\n\nconst WELCOME_MESSAGES = [\n  \"안녕하세요, 무엇을 도와드릴까요?\",\n  \"무엇을 도와드릴까요?\",\n  \"어떤 질문이 있으신가요?\",\n  \"어떤 주제에 대해 이야기해 보고 싶으신가요?\",\n  \"도와드릴 일이 있으시면 말씀해 주세요.\",\n]\n\nexport const getRandomWelcomeMessage = (): string =>\n  WELCOME_MESSAGES[Math.floor(Math.random() * WELCOME_MESSAGES.length)]\n\nconst ChatContainerStyled = styled.div`\n  padding: 1em 2em;\n  background-color: white;\n  height: calc(100% - 50px);\n  box-sizing: border-box;\n  overflow-y: auto;\n\n  &::-webkit-scrollbar {\n    width: 8px;\n  }\n  &::-webkit-scrollbar-thumb {\n    border-radius: 5px;\n    background: #d1d1d1;\n  }\n\n  .chat_message:has([direction=\"right\"])\n    + .chat_message:has([direction=\"right\"]),\n  .chat_message:has([direction=\"left\"])\n    + .chat_message:has([direction=\"left\"]) {\n    margin-top: 5px;\n  }\n`\n\nconst ChatTextFieldContainerStyled = styled.div`\n  display: grid;\n  grid-gap: 0;\n  height: 50px;\n  margin: 0;\n  border-top: 1px solid #efefef;\n  box-shadow: 0 0 5px rgba(128, 128, 128, 0.1);\n  grid-template-columns: 1fr 50px;\n`\n\nconst ChatTextFieldStyled = styled.input`\n  height: 100%;\n  position: relative;\n  width: 100%;\n  border: none;\n  outline: none;\n  padding: 0;\n  box-sizing: border-box;\n  vertical-align: top;\n  margin: 0;\n  width: 100%;\n  padding: 1em;\n  color: #1f1f1f;\n`\n\nconst ChatMessageStyled = styled.div<{\n  direction: \"left\" | \"right\"\n  color: string\n  backgroundColor?: string\n}>`\n  position: relative;\n  color: ${({ color }) => color || \"#3f3f3f\"};\n  background-color: ${({ backgroundColor }) => backgroundColor || \"#eaecef\"};\n  font-size: 0.85em;\n  line-height: 1.375em;\n  width: fit-content;\n  min-width: 20px;\n  max-width: 90%;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: ${({ direction }) =>\n    direction === \"left\" ? \"calc(18px + 0.25em)\" : \"18px\"}};\n  padding-right: 18px;\n  text-align: start;\n  box-sizing: border-box;\n  border-radius: 25px;\n  border-color: #ccc;\n  border-style: none;\n  outline: none;\n\n  .user-avatar {\n    position: absolute;\n    top: -1em;\n    ${({ direction }: any) =>\n      direction === \"left\"\n        ? css`\n            left: -0.5em;\n          `\n        : css`\n            right: -0.5em;\n          `}\n  }\n`\n\ntype ChatMessageProp = {\n  children: React.ReactElement[] | React.ReactElement | string\n  direction: \"left\" | \"right\"\n}\n\nconst ChatMessage = ({ children, direction }: ChatMessageProp) => {\n  const stackStyle =\n    direction === \"left\"\n      ? {\n          alignItems: \"flex-start\",\n        }\n      : {\n          alignItems: \"flex-end\",\n        }\n  const isBot = direction === \"left\"\n  return (\n    <Stack {...stackStyle} className=\"chat_message\">\n      <ChatMessageStyled\n        direction={direction}\n        color={isBot ? \"#2f2f2f\" : \"#efefef\"}\n        backgroundColor={isBot ? \"#eaecef\" : \"#3883f3\"}\n      >\n        <>{children}</>\n        {isBot && (\n          <div className=\"user-avatar\">\n            <Avatar\n              alt=\"Bot\"\n              src=\"/bot_image.png\"\n              sx={{\n                outline: \"3px solid #fff\",\n                width: \"1.5em\",\n                height: \"1.5em\",\n              }}\n            />\n          </div>\n        )}\n      </ChatMessageStyled>\n    </Stack>\n  )\n}\n\nexport type ChatMessageType = {\n  text: string\n  from: \"bot\" | \"user\"\n  action: \"focus\" | \"nothing\" | null\n  data: any\n}\n\ntype ChatSideProps = {\n  messages: ChatMessageType[]\n}\n\nconst ChatSide = ({ messages }: ChatSideProps): React.ReactElement => {\n  const messagesEndRef = useRef<any>(null)\n\n  const scrollToBottom = () => {\n    const { current } = messagesEndRef\n    if (current !== null) {\n      current.scrollTo(0, current.scrollHeight)\n    }\n  }\n\n  useEffect(() => {\n    scrollToBottom()\n  }, [messages])\n\n  const Action: React.FC<{ message: ChatMessageType }> = ({\n    message,\n  }): React.ReactElement => {\n    const { action, data } = message\n    if (action === \"focus\" && data) {\n      return (\n        <Button\n          variant=\"outlined\"\n          size=\"sm\"\n          sx={{ marginTop: \"6px\" }}\n          onClick={() => {\n            alert(data)\n          }}\n        >\n          지도에서 확인하기\n        </Button>\n      )\n    }\n    return <></>\n  }\n\n  return (\n    <ChatContainerStyled ref={messagesEndRef}>\n      <Stack\n        direction=\"column\"\n        justifyContent=\"flex-end\"\n        alignItems=\"stretch\"\n        spacing={2}\n        sx={{\n          height: \"max-content\",\n          minHeight: \"100%\",\n          paddingTop: \"1em\",\n          paddingBottom: \"1em\",\n          boxSizing: \"border-box\",\n        }}\n      >\n        {messages.map((message: ChatMessageType, index: number) => {\n          const { text, from, action, data } = message\n          return (\n            <ChatMessage\n              key={`chat_message_${index}`}\n              direction={from === \"bot\" ? \"left\" : \"right\"}\n            >\n              <>\n                {text}\n                <Action message={message} />\n              </>\n            </ChatMessage>\n          )\n        })}\n      </Stack>\n    </ChatContainerStyled>\n  )\n}\n\ntype ChatInputContainerProps = {\n  controlledText: string | null\n  onTextChange: (text: string) => void\n  onTextSend: (text: string) => void\n}\n\nexport const ChatInputContainer = ({\n  controlledText = \"\",\n  onTextChange,\n  onTextSend,\n}: ChatInputContainerProps): React.ReactElement => {\n  const send = useCallback(() => {\n    const text = controlledText || \"\"\n    if (text.length > 0) onTextSend(text)\n  }, [controlledText, onTextSend])\n\n  return (\n    <>\n      <ChatTextFieldContainerStyled>\n        <ChatTextFieldStyled\n          type=\"text\"\n          placeholder=\"여기에 입력하세요...\"\n          value={controlledText as string}\n          onKeyUp={(event: React.KeyboardEvent<HTMLInputElement>) => {\n            if (event.code === \"Enter\") send()\n          }}\n          onChange={(event: React.ChangeEvent<HTMLInputElement>) => {\n            onTextChange(event.target.value as string)\n          }}\n        />\n        <IconButton\n          size=\"sm\"\n          variant=\"plain\"\n          sx={{\n            borderRadius: 0,\n          }}\n          onClick={() => send()}\n        >\n          <SendRoundedIcon fontSize=\"small\" />\n        </IconButton>\n      </ChatTextFieldContainerStyled>\n    </>\n  )\n}\n\nexport default ChatSide\n","/* global kakao */\n\nimport React, {\n  useEffect,\n  useState,\n  useCallback,\n  useRef,\n  CSSProperties,\n} from \"react\"\nimport axios from \"axios\"\n\nimport Dot from \"../../components/Dot\"\nimport Aside from \"../../components/Aside\"\n\nimport LocalTaxiIcon from \"@mui/icons-material/LocalTaxi\"\nimport HailIcon from \"@mui/icons-material/Hail\"\nimport KeyboardDoubleArrowDownIcon from \"@mui/icons-material/KeyboardDoubleArrowDown\"\n\nimport { CustomOverlayMap, useMap } from \"react-kakao-maps-sdk\"\n\nimport {\n  useStatusState,\n  StatusState,\n  LogFullType,\n} from \"../../providers/StatusProvider\"\nimport ViewerButtons from \"./Controls/ViewerButtons\"\nimport styled from \"styled-components\"\nimport Timeline from \"./Timeline\"\nimport { V_COLORS } from \"./colors\"\nimport ChatSide, {\n  ChatInputContainer,\n  ChatMessageType,\n  getRandomWelcomeMessage,\n} from \"./ChatSide\"\n\nconst MarkerType = {\n  NONE: -1,\n  VEHICLE: 0,\n  PERSON_PICK: 1,\n  PERSON_DROP: 2,\n}\n\ntype MarkerPosition = {\n  key: string | null\n  color?: string\n  size: number\n  lat: number\n  lng: number\n  type: number\n}\n\ntype VehicleState = {\n  name: string\n  lat: number\n  lng: number\n  allocated_id: number | null\n}\n\ntype TaskType = {\n  id: number\n  drop_lat: number\n  drop_lng: number\n  pick_lat: number\n  pick_lng: number\n  status: number\n  time: number\n}\n\nconst LogIcon = ({\n  color,\n  style,\n  children,\n  tooltip = null,\n  onClick,\n}: any): React.ReactElement => {\n  const [isHover, setHover] = useState<boolean>(false)\n  return (\n    <div\n      style={{\n        backgroundColor: color || \"black\",\n        display: \"flex\",\n        justifyItems: \"center\",\n        alignItems: \"center\",\n        width: \"32px\",\n        height: \"32px\",\n        borderRadius: \"6rem\",\n        ...style,\n      }}\n      onMouseOver={() => setHover(true)}\n      onMouseLeave={() => setHover(false)}\n      onClick={onClick || null}\n    >\n      <>{children}</>\n      <>{tooltip != null && isHover && tooltip}</>\n    </div>\n  )\n}\n\nconst VehicleLogInfoStyled = styled.div`\n  width: calc(100% - 12px);\n  position: relative;\n  box-sizing: border-box;\n  padding: 0 6px;\n  display: flex;\n  align-items: center;\n`\n\nconst RoadLineStyled = styled.div`\n  position: absolute;\n  width: 100%;\n  height: 3px;\n  background-color: #efefef;\n  border-radius: 1em;\n  z-index: 0;\n`\n\nconst VehicleIconTooltipStyled = styled.div`\n  position: absolute;\n  bottom: calc(-32px / 2 - -8px);\n  font-size: 12px;\n  left: calc(32px / 2);\n  width: fit-content;\n  white-space: nowrap;\n  word-break: keep-all;\n  background: ${({ color }: any) => color};\n  color: white;\n  border-radius: 3px;\n  padding: 2px 6px;\n  box-sizing: border-box;\n  min-width: 32px;\n  transform: translateX(-50%);\n  text-align: center;\n  box-shadow: 0 0 3px rgba(128, 128, 128, 0.2);\n`\n\ntype DisplayIconProps = {\n  type: number\n  style?: CSSProperties\n}\n\nconst Icon = ({ type, style = {} }: DisplayIconProps): any => {\n  const iconStyle = {\n    fill: \"white\",\n    marginTop: \"-1px\",\n    width: \"75%\",\n    ...style,\n  }\n  if (type == MarkerType.NONE) {\n    return <></>\n  } else if (type == MarkerType.VEHICLE) {\n    return <LocalTaxiIcon style={iconStyle} />\n  } else if (type == MarkerType.PERSON_PICK) {\n    return <HailIcon style={iconStyle} />\n  } else if (type == MarkerType.PERSON_DROP) {\n    return <KeyboardDoubleArrowDownIcon style={iconStyle} />\n  }\n}\n\nconst TASK_PICK_COLOR = \"#1d35ef66\"\nconst TASK_DROP_COLOR = \"#4d75ef66\"\n\nconst LogInfoStyled = styled.div`\n  display: grid;\n  grid-template-columns: auto 1fr auto;\n  padding: 0.5rem 0;\n`\n\nconst get_slope_weight = (\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  cx: number,\n  cy: number\n) => {\n  const lx = Math.abs(x2 - x1)\n  const ly = Math.abs(y2 - y1)\n  const dx = cx - x1\n  const dy = cy - y1\n  const r = Math.sqrt(dx * dx + dy * dy) / Math.sqrt(lx * lx + ly * ly)\n  return Math.max(0.0, Math.min(r * 100.0, 100.0))\n}\n\nconst ViewerBottomFixedWrapperStyled = styled.div<{ expand: boolean }>`\n  position: fixed;\n  width: 100%;\n  bottom: 0;\n  left: 0;\n  background: white;\n  height: 300px;\n  transform: ${({ expand }: any) =>\n    expand ? \"translateY(0px)\" : \"translateY(300px)\"};\n  transition: transform 300ms ease-in-out;\n  box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.2);\n`\n\nconst ViewerButtonsClearStyled = styled.div`\n  position: relative;\n  width: 100%;\n`\n\nconst TimelineWrapperStyled = styled.div`\n  position: absolute;\n  overflow: auto;\n  width: 100%;\n  height: 100%;\n  bottom: 0;\n`\n\nconst SERVER_HOST = process.env.REACT_APP_SERVER_HOST as string\n\nconst INITIAL_DATE = new Date(\"2020-08-29 06:00\")\nconst VEHICLES = 10\nconst TASKS = 130\nconst JUMP_MINS = 5\n\nconst parseDate = (t: Date) => ({\n  year: t.getFullYear(),\n  month: t.getMonth() + 1,\n  day: t.getDate(),\n  hour: t.getHours(),\n  minute: t.getMinutes(),\n  second: t.getSeconds(),\n})\n\nconst Viewer = (): React.ReactElement => {\n  const [markerPositions, setMarkerPositions] = useState<Array<MarkerPosition>>(\n    []\n  )\n  const [status, setStatus] = useStatusState()\n  const [level, setLevel] = useState<number>(3)\n  const [runable, setRunable] = useState<boolean>(false)\n  const [running, setRunning] = useState<boolean>(false)\n  const [speed, setSpeed] = useState<number>(1.0)\n  const [progressMax, setProgressMax] = useState<number>(0)\n  const [progress, setProgress] = useState<number>(0)\n  const [elapsedMinutes, setElapsedMinutes] = useState<number>(0)\n  const [log, setLog] = useState<LogFullType | null>()\n  const [vehiclesState, setVehiclesState] = useState<Map<string, VehicleState>>(\n    new Map()\n  )\n  const [displayTime, setDisplayTime] = useState<Date>(INITIAL_DATE)\n\n  // auto play when starts\n  useEffect(() => {\n    const t = setTimeout(() => {\n      setRunning(true)\n    }, 1000)\n    return () => {\n      clearTimeout(t)\n    }\n  }, [])\n\n  useEffect(() => {\n    const timeShifted = new Date(\n      INITIAL_DATE.getTime() + elapsedMinutes * 60 * 1000\n    )\n    console.log(\"elapsed\", elapsedMinutes)\n    console.log(\"time\", timeShifted)\n    setDisplayTime(timeShifted)\n    const { year, month, day, hour, minute } = parseDate(timeShifted)\n    const url = `${SERVER_HOST}/log/${year}/${month}/${day}/${hour}/${minute}?vehicles=${VEHICLES}&tasks=${TASKS}`\n    axios.get(url).then((response) => {\n      setLog(response.data as LogFullType)\n    })\n  }, [elapsedMinutes])\n\n  useEffect(() => {\n    const { log: logFull } = status as StatusState\n    setRunable(log !== null)\n    setLog(logFull)\n  }, [status])\n\n  const map = useMap()\n\n  useEffect(() => {\n    setLevel(map.getLevel())\n  }, [map])\n\n  useEffect(() => {\n    map.setLevel(level)\n  }, [map, level])\n\n  useEffect(() => {\n    if (!log) return\n\n    const { time, vehicles, tasks } = log\n\n    const vMarkers: Array<MarkerPosition> = Array.from(vehicles || []).map(\n      ({ name, lat, lng }: any) => ({\n        key: name,\n        color: V_COLORS.get(name) || \"#cfcfcf\",\n        size: 5,\n        lat,\n        lng,\n        type: MarkerType.VEHICLE,\n      })\n    )\n\n    const tMarkers: Array<MarkerPosition> = Array.from(tasks || [])\n      .map(\n        ({\n          id,\n          pick_lat,\n          pick_lng,\n          drop_lat,\n          drop_lng,\n          status,\n        }: any): any[] => [\n          0 <= status && status <= 5\n            ? {\n                key: `task-${id}-pick`,\n                color: TASK_PICK_COLOR,\n                size: 4,\n                lat: pick_lat,\n                lng: pick_lng,\n                type: MarkerType.PERSON_PICK,\n              }\n            : null,\n          {\n            key: `task-${id}-drop`,\n            color: TASK_DROP_COLOR,\n            size: 4,\n            lat: drop_lat,\n            lng: drop_lng,\n            type: MarkerType.PERSON_DROP,\n          },\n        ]\n      )\n      .flat()\n      .filter((value) => value !== null)\n\n    console.log(\"markers[v]\", vMarkers)\n    console.log(\"markers[t]\", tMarkers)\n\n    setMarkerPositions([...vMarkers, ...tMarkers])\n    setVehiclesState((prev: Map<string, VehicleState>) => {\n      const newState = new Map(prev)\n      for (const vehicle of Array.from(vehicles || [])) {\n        const { name } = vehicle as VehicleState\n        newState.set(name, vehicle as VehicleState)\n      }\n      return newState\n    })\n  }, [log])\n\n  useEffect(() => {\n    if (!log) return\n    setVehiclesState((prev: Map<string, VehicleState>) => {\n      const nameCollected: string[] = Array.from(\n        new Set<string>(log.vehicles.map((v: any): string => v.name || \"\"))\n      )\n\n      const newMap = new Map(prev)\n      for (const name of nameCollected) {\n        // add empty values having name only\n        newMap.set(name, {\n          name,\n          lat: -1,\n          lng: -1,\n          allocated_id: null,\n        } as VehicleState)\n      }\n      return newMap\n    })\n  }, [log])\n\n  useEffect(() => {\n    if (!running) return\n\n    // 1 frame contains 60 secs\n    const DEFAULT_TIMESTEP = 60 * 1000\n    // 1 frame / 1000 ms\n    const interval = DEFAULT_TIMESTEP / 60 / (speed || 1.0)\n    console.log(\"info\", interval, running, speed)\n\n    const timer = setTimeout(() => {\n      setElapsedMinutes((prev) => prev + JUMP_MINS)\n    }, interval)\n\n    return () => {\n      clearTimeout(timer)\n    }\n  }, [running, speed, elapsedMinutes])\n\n  const fitMapBound = useCallback(\n    (nodes: Array<{ lat: number; lng: number }>) => {\n      if (nodes.length < 1) return\n      const bounds = new kakao.maps.LatLngBounds()\n      nodes.forEach(({ lat, lng }) => {\n        bounds.extend(new kakao.maps.LatLng(lat, lng))\n      })\n      map.setBounds(bounds)\n    },\n    [map]\n  )\n\n  // fit map bound when first map loaded\n  useEffect(() => {\n    fitMapBound([\n      { lat: 37.6299601, lng: 126.8629739 },\n      { lat: 37.4712457, lng: 127.1006907 },\n    ])\n  }, [])\n\n  const focusTo = useCallback(\n    ({ lat, lng }: any) => {\n      map.panTo(new kakao.maps.LatLng(lat, lng))\n    },\n    [map]\n  )\n\n  type LogItemProps = {\n    vehicle: VehicleState\n    tasks: TaskType[]\n  }\n\n  const LogItemVehicleWithTask = ({ vehicle, tasks }: LogItemProps) => {\n    const { name: vehicle_id, lat, lng, allocated_id } = vehicle\n\n    const vehicleTooltip = (\n      <VehicleIconTooltipStyled color={V_COLORS.get(vehicle_id)}>\n        {vehicle_id}\n      </VehicleIconTooltipStyled>\n    )\n\n    if (tasks.length < 1) {\n      const IconEmptyStyle = {\n        backgroundColor: \"transparent\",\n        borderWidth: \"1px\",\n        borderColor: \"gray\",\n        borderStyle: \"dashed\",\n      }\n      return (\n        <>\n          <LogInfoStyled className=\"pairs\" key={`log-info-${vehicle_id}`}>\n            <LogIcon\n              color={\"transparent\"}\n              style={{\n                justifySelf: \"flex-start\",\n                ...IconEmptyStyle,\n              }}\n            />\n            <VehicleLogInfoStyled>\n              <RoadLineStyled\n                style={{\n                  borderTop: `dashed 2px ${V_COLORS.get(vehicle_id)}`,\n                  height: \"auto\",\n                  background: \"transparent\",\n                  borderRadius: 0,\n                }}\n              />\n              <div\n                style={{\n                  position: \"absolute\",\n                  width: \"calc(100% - 32px)\",\n                  top: 0,\n                }}\n              >\n                <LogIcon\n                  key={`logicon-${vehicle_id}`}\n                  color={V_COLORS.get(vehicle_id)}\n                  style={{\n                    position: \"absolute\",\n                    left: \"50%\",\n                    transition: \"all 300ms ease\",\n                    zIndex: 1,\n                    backgroundColor: \"white\",\n                    borderWidth: \"1px\",\n                    borderColor: V_COLORS.get(vehicle_id),\n                    borderStyle: \"dashed\",\n                  }}\n                  tooltip={vehicleTooltip}\n                >\n                  <Icon\n                    type={MarkerType.VEHICLE}\n                    style={{\n                      margin: \"0 auto\",\n                      fill: V_COLORS.get(vehicle_id),\n                    }}\n                  />\n                </LogIcon>\n              </div>\n            </VehicleLogInfoStyled>\n            <LogIcon\n              color={\"transparent\"}\n              style={{\n                justifySelf: \"flex-end\",\n                ...IconEmptyStyle,\n              }}\n            />\n          </LogInfoStyled>\n        </>\n      )\n    }\n\n    const task = tasks[0]\n    const {\n      id: task_id,\n      status,\n      pick_lat,\n      pick_lng,\n      drop_lat,\n      drop_lng,\n    }: TaskType = task as TaskType\n\n    const isPicked = status > 5\n    const isDroped = status > 6\n\n    const IconReadyStyle = {\n      backgroundColor: \"transparent\",\n      borderWidth: \"1px\",\n      borderColor: V_COLORS.get(vehicle_id),\n      borderStyle: \"dashed\",\n    }\n\n    const IconNotReadyStyle = {\n      borderWidth: \"1px\",\n      borderColor: \"transparent\",\n      borderStyle: \"solid\",\n    }\n\n    const IconReadyInnerStyle = {\n      fill: V_COLORS.get(vehicle_id),\n    }\n\n    return (\n      <LogInfoStyled className=\"pairs\" key={`log-info-${vehicle_id}`}>\n        <LogIcon\n          color={status <= 5 ? \"transparent\" : V_COLORS.get(vehicle_id)}\n          style={{\n            justifySelf: \"flex-start\",\n            cursor: \"pointer\",\n            ...(isPicked ? IconNotReadyStyle : IconReadyStyle),\n          }}\n          onClick={() => {\n            focusTo({\n              lat: pick_lat,\n              lng: pick_lng,\n            })\n          }}\n        >\n          <Icon\n            type={MarkerType.PERSON_PICK}\n            style={{\n              margin: \"0 auto\",\n              ...(isPicked ? {} : IconReadyInnerStyle),\n            }}\n          />\n        </LogIcon>\n        <VehicleLogInfoStyled>\n          <RoadLineStyled\n            style={\n              isPicked ? { backgroundColor: V_COLORS.get(vehicle_id) } : {}\n            }\n          />\n          <div\n            style={{\n              position: \"absolute\",\n              width: \"calc(100% - 32px)\",\n              top: 0,\n            }}\n          >\n            <LogIcon\n              key={`logicon-${vehicle_id}`}\n              color={V_COLORS.get(vehicle_id)}\n              style={{\n                position: \"absolute\",\n                left: `${get_slope_weight(\n                  pick_lat,\n                  pick_lng,\n                  drop_lat,\n                  drop_lng,\n                  lat,\n                  lng\n                )}%`,\n                transition: \"all 300ms ease\",\n                cursor: \"pointer\",\n                zIndex: 1,\n              }}\n              tooltip={vehicleTooltip}\n              onClick={() => {\n                focusTo({\n                  lat,\n                  lng,\n                })\n              }}\n            >\n              <Icon\n                type={MarkerType.VEHICLE}\n                style={{\n                  margin: \"0 auto\",\n                }}\n              />\n            </LogIcon>\n          </div>\n        </VehicleLogInfoStyled>\n        <LogIcon\n          color={V_COLORS.get(vehicle_id)}\n          style={{\n            justifySelf: \"flex-end\",\n            cursor: \"pointer\",\n            ...(isDroped ? IconNotReadyStyle : IconReadyStyle),\n          }}\n          onClick={() => {\n            focusTo({\n              lat: drop_lat,\n              lng: drop_lng,\n            })\n          }}\n        >\n          <Icon\n            type={MarkerType.PERSON_DROP}\n            style={{\n              margin: \"0 auto\",\n              ...(isDroped ? {} : IconReadyInnerStyle),\n            }}\n          />\n        </LogIcon>\n      </LogInfoStyled>\n    )\n  }\n\n  const LogInfo = useCallback(\n    ({ time, vehicles, tasks }: any) => {\n      return (\n        <>\n          {Array.from(vehicles.values())\n            .map((value) => value as VehicleState)\n            .map((thisVehicle: VehicleState) => {\n              const { name, lat, lng, allocated_id } = thisVehicle\n              const thisTasks = Array.from(tasks || []).filter(\n                ({ id }: any) => id === allocated_id\n              )\n              return (\n                <LogItemVehicleWithTask\n                  vehicle={thisVehicle}\n                  tasks={thisTasks as TaskType[]}\n                />\n              )\n            })}\n        </>\n      )\n    },\n    [focusTo, vehiclesState]\n  )\n\n  const [isExpandTimeline, setExpanedTimeline] = useState<boolean>(true)\n  const [chatInput, setChatInput] = useState<string>(\"\")\n  const [chatMessages, setChatMessages] = useState<Array<ChatMessageType>>([\n    {\n      text: getRandomWelcomeMessage(),\n      from: \"bot\",\n      action: \"nothing\",\n    } as ChatMessageType,\n  ])\n  const addChatMessage = (message: ChatMessageType) => {\n    setChatMessages((prev) => prev.concat(message))\n  }\n\n  return (\n    <>\n      {markerPositions.map(\n        ({ key, color, size, lat, lng, type }: MarkerPosition) => (\n          <CustomOverlayMap\n            key={`marker-${key}`}\n            position={{\n              lat,\n              lng,\n            }}\n            ref={(ref: any) => {\n              if (ref == null) return\n              const parentNode = ref.cc.parentElement\n              parentNode.className = \"vehicle-marker\"\n            }}\n          >\n            <Dot color={color || \"dodgerblue\"} size={size / level}>\n              <Icon type={type as number} />\n            </Dot>\n          </CustomOverlayMap>\n        )\n      )}\n\n      <ViewerBottomFixedWrapperStyled expand={isExpandTimeline}>\n        <ViewerButtonsClearStyled>\n          <ViewerButtons\n            running={running}\n            runable={runable}\n            progressMax={progressMax}\n            progressCurrent={progress}\n            speed={speed}\n            expanded={isExpandTimeline}\n            onSelectSpeed={setSpeed}\n            onProgressUpdated={(i: number) =>\n              setProgress(elapsedMinutes * JUMP_MINS)\n            }\n            onClickPlay={() => setRunning(!running)}\n            onClickExpand={setExpanedTimeline}\n          />\n        </ViewerButtonsClearStyled>\n        <TimelineWrapperStyled>\n          <Timeline time={displayTime} />\n        </TimelineWrapperStyled>\n      </ViewerBottomFixedWrapperStyled>\n\n      <Aside>\n        <ChatSide messages={chatMessages} />\n        <ChatInputContainer\n          controlledText={chatInput}\n          onTextChange={(text: string) => setChatInput(text)}\n          onTextSend={() => {\n            console.log(chatInput)\n            // append user message\n            addChatMessage({\n              text: chatInput,\n              from: \"user\",\n            } as ChatMessageType)\n            // request and append bot response\n            axios.post(`${SERVER_HOST}/chat`, chatInput).then((response) => {\n              const res = response.data\n              if (!res) return\n              const { text, action, data } = res\n              addChatMessage({\n                text,\n                from: \"bot\",\n                action,\n                data,\n              } as ChatMessageType)\n            })\n            setChatInput(\"\")\n          }}\n        />\n      </Aside>\n    </>\n  )\n}\n\nexport default Viewer\n","import React from \"react\"\nimport styled from \"styled-components\"\n\ntype CircleStyleProps = {\n  size: number\n  color?: string\n  selected: boolean\n  children?: React.ReactNode | React.ReactNode[]\n}\n\nconst Circle = styled.div`\n  position: absolute;\n  display: flex;\n  width: 0.75em;\n  height: 0.75em;\n  background: white;\n  border-width: 0.15rem;\n  border-style: solid;\n  border-color: ${({ selected, color = \"#d3232f\" }: CircleStyleProps) =>\n    selected ? \"black\" : color};\n  border-radius: 8rem;\n  align-items: center;\n  justify-content: center;\n  scale: ${({ size }: CircleStyleProps) => size};\n  box-sizing: border-box;\n  cursor: pointer;\n\n  &:hover {\n    border-color: ${({ selected, color = \"#a10e25\" }: CircleStyleProps) =>\n      selected ? \"black\" : color};\n  }\n`\n\nconst Container = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n`\n\ntype PointProps = {\n  id: string\n  size?: number\n  color?: string\n  selected?: boolean\n  children?: React.ReactNode | React.ReactNode[]\n  onMouseEnter?: React.MouseEventHandler<any>\n  onMouseLeave?: React.MouseEventHandler<any>\n  onMouseDown?: React.MouseEventHandler<any>\n  onMouseUp?: React.MouseEventHandler<any>\n  onClick?: React.MouseEventHandler<any>\n}\n\nconst Point = ({\n  id,\n  size = 2,\n  selected = false,\n  color,\n  children,\n  onMouseEnter,\n  onMouseDown,\n  onMouseLeave,\n  onMouseUp,\n  onClick,\n}: PointProps) => {\n  return (\n    <Container data-id={id}>\n      <Circle\n        size={size}\n        color={color}\n        selected={selected}\n        onMouseEnter={onMouseEnter}\n        onMouseLeave={onMouseLeave}\n        onMouseDown={onMouseDown}\n        onMouseUp={onMouseUp}\n        onClick={onClick}\n      >\n        <div className=\"icon\">{children}</div>\n      </Circle>\n    </Container>\n  )\n}\n\nexport default Point\n","import React, { useCallback, useRef } from \"react\"\n\nimport GrainIcon from \"@mui/icons-material/Grain\"\nimport PolylineIcon from \"@mui/icons-material/Polyline\"\nimport OpenWithIcon from \"@mui/icons-material/OpenWith\"\nimport UploadIcon from \"@mui/icons-material/Upload\"\nimport DownloadIcon from \"@mui/icons-material/Download\"\n\nimport IconButton from \"../../../components/IconButton\"\nimport HorizontalContainer, {\n  Divider,\n} from \"../../../components/HorizontalContainer\"\n\ntype MenuButtonProps = {\n  title: string\n  active?: boolean\n  icon: React.ReactElement\n  onClick: () => void\n}\n\nconst MenuButton = ({\n  title,\n  active = false,\n  icon,\n  onClick,\n}: MenuButtonProps) => {\n  return (\n    <IconButton\n      tooltip={title}\n      tooltipColor=\"primary\"\n      tooltipPlacement=\"top\"\n      active={active}\n      variant=\"outlined\"\n      size={\"32px\"}\n      onClick={onClick}\n    >\n      {icon}\n    </IconButton>\n  )\n}\n\ntype EditorButtonsProps = {\n  editMode: string\n  onModeChanged: (mode: string) => void\n  onClickUpload: (event: React.ChangeEvent<HTMLInputElement>) => void\n  onClickDownload: () => void\n}\n\nconst EditorButtons = ({\n  editMode,\n  onModeChanged,\n  onClickUpload,\n  onClickDownload,\n}: EditorButtonsProps): React.ReactElement => {\n  const onSelectMode = (mode: string) => {\n    onModeChanged(mode)\n  }\n\n  const ModeButtons = useCallback((): React.ReactElement => {\n    return (\n      <>\n        <MenuButton\n          title=\"점 추가/삭제\"\n          active={editMode === \"add\"}\n          icon={<GrainIcon />}\n          onClick={() => onSelectMode(\"add\")}\n        />\n        <MenuButton\n          title=\"점 연결\"\n          active={editMode === \"link\"}\n          icon={<PolylineIcon />}\n          onClick={() => onSelectMode(\"link\")}\n        />\n        <MenuButton\n          title=\"점 이동\"\n          active={editMode === \"move\"}\n          icon={<OpenWithIcon />}\n          onClick={() => onSelectMode(\"move\")}\n        />\n      </>\n    )\n  }, [editMode])\n\n  const UploadButton = useCallback((): React.ReactElement => {\n    const ref = useRef<HTMLInputElement>(null)\n    return (\n      <>\n        <label\n          htmlFor=\"upload-log\"\n          style={{\n            width: \"100%\",\n          }}\n        >\n          <input\n            ref={ref}\n            style={{ display: \"none\" }}\n            id=\"upload-log\"\n            name=\"upload-log\"\n            type=\"file\"\n            accept=\".json,application/json\"\n            onChange={onClickUpload}\n          />\n          <MenuButton\n            title=\"업로드\"\n            icon={<UploadIcon />}\n            onClick={() => {\n              if (ref.current) {\n                ref.current.click()\n              }\n            }}\n          />\n        </label>\n      </>\n    )\n  }, [onClickUpload])\n\n  const DownloadButton = useCallback(\n    (): React.ReactElement => (\n      <MenuButton\n        title=\"다운로드\"\n        icon={<DownloadIcon />}\n        onClick={onClickDownload}\n      />\n    ),\n    [onClickDownload]\n  )\n\n  return (\n    <>\n      <HorizontalContainer position=\"bottom\">\n        <ModeButtons />\n        <Divider />\n        <UploadButton />\n        <DownloadButton />\n      </HorizontalContainer>\n    </>\n  )\n}\n\nexport default EditorButtons\n","export const randomColor = () => \"#\" + Math.random().toString(16).slice(-6)\n\nexport const randomLightColor = () => {\n  const rgb = shuffleArray([\n    Math.random() * 128 + 48,\n    Math.random() * 128 + 80,\n    Math.random() * 64 + 192\n  ].map(Math.round));\n  return arrayToHex(rgb)\n}\n\nexport const randomDarkColor = () => {\n  const rgb = shuffleArray([\n    Math.random() * 64,\n    Math.random() * 128,\n    Math.random() * 64 + 128\n  ].map(Math.round))\n  return arrayToHex(rgb)\n}\n\nfunction arrayToHex(rgb: number[]) {\n  return \"#\" + rgb.map((c: number) => c.toString(16).padStart(2, \"0\")).join(\"\")\n}\n\nfunction shuffleArray(array: any[]) {\n  const a = [...array]\n  for (var i = a.length - 1; i > 0; i--) {\n      var j = Math.floor(Math.random() * (i + 1));\n      var temp = a[i];\n      a[i] = a[j];\n      a[j] = temp;\n  }\n  return a\n}\n","export interface Node {\n  lat: number\n  lng: number\n}\n\nexport interface Edge {\n  from: number\n  to: number\n}\n\nclass UnionSet {\n  nodes: Node[]\n  parentIdx: Map<string | number, string | number>\n\n  constructor(nodes: Node[]) {\n    this.nodes = nodes\n\n    this.parentIdx = new Map()\n  }\n\n  hasKey(id: string | number): boolean {\n    return id in this.parentIdx\n  }\n\n  find(id: string | number): string | number {\n    const parent = this.parentIdx.get(id)\n    if (!parent || id === parent) {\n      this.parentIdx.set(id, id)\n      return id\n    } else {\n      const president = this.find(parent)\n      this.parentIdx.set(id, president)\n      return president\n    }\n  }\n\n  merge(a: string | number, b: string | number): void {\n    const ga = this.find(a)\n    const gb = this.find(b)\n    this.parentIdx.set(ga, gb)\n  }\n\n  keys(): Array<string | number> {\n    return Array.from(this.parentIdx.keys())\n  }\n}\n\nexport default UnionSet\n","/* global kakao */\n\nimport React, { useEffect, useState, useCallback, useMemo } from \"react\"\n\nimport Point from \"../../components/Point\"\nimport EditorButtons from \"./Controls/EditorButtons\"\nimport { jsonToBlob, saveFile } from \"../../helpers/fileInteracts\"\nimport { randomDarkColor } from \"../../helpers/colors\"\nimport UnionSet from \"../../helpers/unionSet\"\n\nimport { CustomOverlayMap, useMap, Polyline } from \"react-kakao-maps-sdk\"\n\ntype NodeType = {\n  key: string\n  lat: number\n  lng: number\n}\n\ntype EdgeType = {\n  from: string\n  to: string\n}\n\nconst saveGraphFile = (\n  nodes: Array<NodeType>,\n  edges: Array<EdgeType>\n): void => {\n  const keys: Array<string> = nodes.map(({ key }) => key)\n  const keyToIndex = (key: string): number => keys.indexOf(key)\n  const transformed = {\n    nodes: nodes.map(({ key, lat, lng }: NodeType) => ({\n      id: keyToIndex(key),\n      lat,\n      lng,\n      info: {},\n    })),\n    edges: edges.map(({ from, to }: EdgeType) => ({\n      from: keyToIndex(from),\n      to: keyToIndex(to),\n    })),\n  }\n  const filename = \"graph-\" + new Date().toISOString() + \".json\"\n  saveFile(filename, jsonToBlob(transformed))\n}\n\nconst Editor = (): React.ReactElement => {\n  const map: kakao.maps.Map = useMap()\n  const [nodes, setNodes] = useState<Array<NodeType>>([])\n  const [bufNodes, _setBufNodes] = useState<Array<NodeType>>([])\n  const [edges, setEdges] = useState<Array<EdgeType>>([])\n  const [level, setLevel] = useState<number>(1)\n  const [editMode, setEditMode] = useState<string>(\"add\")\n  const [selected, setSelected] = useState<Array<string>>([])\n  const [cursorPos, setCursorPos] = useState<NodeType>()\n\n  const [_visibleEdges, _setVisibleEdges] = useState<EdgeType[]>([])\n  const [graphColors, setGraphColors] = useState<Map<string, string>>(new Map())\n\n  const visibleEdges = useMemo((): Array<EdgeType> => {\n    console.log(\"_visibleEdges\", _visibleEdges)\n    return _visibleEdges.map((edge: EdgeType) => {\n      const { from, to } = edge\n      return edge\n    })\n  }, [_visibleEdges])\n\n  useEffect(() => {\n    const _edges = edges.filter(({ from, to }: EdgeType) => {\n      for (const { key } of bufNodes) {\n        if (from === key || to === key) return true\n      }\n      return false\n    })\n    _setVisibleEdges(_edges)\n  }, [bufNodes, edges])\n\n  useEffect(() => {\n    const union = new UnionSet(nodes)\n    for (const e of edges) {\n      union.merge(e.from, e.to)\n    }\n    const colorMap = new Map<string, string>()\n    const groupColors = new Map<string, string>()\n    for (const key of union.keys()) {\n      groupColors.set(key as string, randomDarkColor())\n    }\n    for (const { from, to } of edges) {\n      const a = union.find(from) as string\n      const b = union.find(to) as string\n      colorMap.set(from, groupColors.get(a) as string)\n      colorMap.set(to, groupColors.get(b) as string)\n    }\n    console.log(\"set graph colors\", colorMap)\n    setGraphColors(colorMap)\n  }, [nodes, edges])\n\n  const getMapBounds = useCallback(() => {\n    const bounds = map.getBounds()\n    const level = map.getLevel()\n    const [ne, sw] = [bounds.getNorthEast(), bounds.getSouthWest()]\n    const top = sw.getLat()\n    const left = sw.getLng()\n    const bottom = ne.getLat()\n    const right = ne.getLng()\n    const width: number = right - left\n    const height: number = bottom - top\n    return {\n      level,\n      top,\n      left,\n      bottom,\n      right,\n      width,\n      height,\n    }\n  }, [map])\n\n  const setTmpNodes = useCallback(\n    (newNodes: Array<NodeType>) => {\n      const { top, left, bottom, right, width, height, level } = getMapBounds()\n      const nodesInBounds = newNodes.filter(\n        ({ lat, lng }: NodeType): boolean =>\n          top <= lat && lat <= bottom && left <= lng && lng <= right\n      )\n      type nodeInGrid = { lat: number; lng: number; grid: string }\n      const nodesInGrid: Array<nodeInGrid> = nodesInBounds.map(\n        ({ key, lat, lng }) => ({\n          id: key,\n          key,\n          lat,\n          lng,\n          grid: `${Math.round(lat / (width / 100))},${Math.round(\n            lng / (height / 100)\n          )}`,\n        })\n      )\n      const compressNodesInGrid: Array<NodeType> = [\n        ...Array.from(\n          new Map(\n            nodesInGrid.map(({ key, grid, lat, lng }: any) => [\n              grid,\n              {\n                id: key,\n                key,\n                lat,\n                lng,\n              } as NodeType,\n            ])\n          ).values()\n        ),\n      ]\n      console.log(\"Bounds:\", top, left, bottom, right)\n      console.log(\"Nodes(Grid)\", nodesInGrid, compressNodesInGrid)\n      console.log(\"Bounds (width, height)\", bottom - top, right - left, level)\n      console.log(\"Set New Temporal Nodes\", compressNodesInGrid)\n      _setBufNodes(compressNodesInGrid)\n    },\n    [getMapBounds]\n  )\n\n  const isSelected = useCallback(\n    (id: string) => selected.indexOf(id) !== -1,\n    [selected]\n  )\n\n  const selectedNode = useMemo((): NodeType | null => {\n    const node = nodes.filter(({ key }) => isSelected(key))\n    return node.length > 0 ? node[0] : null\n  }, [nodes, isSelected])\n\n  const createEdge = (from: NodeType, to: NodeType) => {\n    setEdges((prev) =>\n      prev\n        .filter((edge) => !(edge.from == from.key && edge.to == to.key))\n        .concat({\n          from: from.key,\n          to: to.key,\n        } as EdgeType)\n    )\n  }\n\n  const findNode = (id: string, array: Array<NodeType>): NodeType | null => {\n    for (const node of array) {\n      const { key } = node\n      if (key === id) return node\n    }\n    return null\n  }\n\n  const getNode = useCallback(\n    (id: string): NodeType | null => {\n      return findNode(id, nodes)\n    },\n    [nodes]\n  )\n\n  const isNodeVisible = useCallback(\n    (id: string): boolean => {\n      const result = findNode(id, bufNodes) !== null\n      console.log(\"isNodeVisible\", id, result)\n      return result\n    },\n    [bufNodes]\n  )\n\n  useEffect(() => {\n    setLevel(map.getLevel())\n    setTimeout(() => {\n      map.relayout()\n    }, 0)\n  }, [map])\n\n  useEffect(() => {\n    // update edge to sync up\n    const hasNode = (id: string): boolean => getNode(id) !== null\n    setEdges((prev) =>\n      prev.filter(({ from, to }: EdgeType) => hasNode(from) && hasNode(to))\n    )\n  }, [getNode, setEdges])\n\n  useEffect(() => {\n    console.log(\"selected\", selected)\n    if (selected.length >= 2) {\n      const [fromID, toID] = selected\n      const [from, to] = [getNode(fromID), getNode(toID)]\n      if (from !== null && to !== null) {\n        createEdge(from, to)\n        setCursorPos(undefined)\n        setSelected([])\n      }\n      return\n    }\n  }, [selected, getNode, setCursorPos])\n\n  const onMapClick = useCallback(\n    (evt: any) => {\n      const { latLng: loc } = evt\n      if (editMode !== \"add\") {\n        return\n      }\n      const lat = loc.getLat()\n      const lng = loc.getLng()\n      console.log(\"Map Clicked\", lat, lng)\n      setNodes((prev) => {\n        const nodeId = Math.random().toString(16).slice(2) as string\n        const node = { key: `node-${nodeId}`, lat, lng } as NodeType\n        console.log(\"add node\", node)\n        return [...prev, node]\n      })\n    },\n    [editMode]\n  )\n\n  const onMapMouseUp = useCallback((evt: any) => {}, [])\n\n  const onMapMouseMove = useCallback(\n    (evt: any) => {\n      const { latLng: loc } = evt\n      const lat = loc.getLat()\n      const lng = loc.getLng()\n      if (editMode === \"link\") {\n        setCursorPos({ key: \"cursor\", lat, lng } as NodeType)\n      } else if (editMode === \"move\") {\n        if (selected.length != 1) {\n          return\n        }\n        setNodes((prev) =>\n          prev.map((node: NodeType): NodeType => {\n            if (selected[0] !== node.key) {\n              return node\n            } else {\n              return { ...node, lat, lng }\n            }\n          })\n        )\n      }\n    },\n    [editMode, setNodes, selected, setCursorPos]\n  )\n\n  useEffect(() => {\n    const updateNodes = () => setTmpNodes(nodes)\n    kakao.maps.event.addListener(map, \"idle\", updateNodes)\n    return () => {\n      kakao.maps.event.addListener(map, \"idle\", updateNodes)\n    }\n  }, [map, nodes])\n\n  useEffect(() => {\n    setTmpNodes(nodes)\n  }, [nodes])\n\n  useEffect(() => {\n    map.setCursor(\"default\")\n    kakao.maps.event.addListener(map, \"click\", onMapClick)\n    kakao.maps.event.addListener(map, \"mouseup\", onMapMouseUp)\n    kakao.maps.event.addListener(map, \"mousemove\", onMapMouseMove)\n    return () => {\n      map.setCursor(\"\")\n      kakao.maps.event.removeListener(map, \"click\", onMapClick)\n      kakao.maps.event.removeListener(map, \"mouseup\", onMapMouseUp)\n      kakao.maps.event.removeListener(map, \"mousemove\", onMapMouseMove)\n    }\n  }, [map, onMapClick, onMapMouseUp, onMapMouseMove])\n\n  const onMouseDownPoint = useCallback(\n    (evt: any) => {\n      const container = evt.target.closest(\"[data-id]\") as HTMLElement\n      if (!container) return\n      const id = container.getAttribute(\"data-id\") || \"\"\n      const mouseType = evt.button as number\n      if (editMode === \"add\") {\n        if (mouseType === 2) {\n          // right button\n          setNodes((prev) => [...prev].filter(({ key }) => key !== id))\n        }\n      } else if (editMode === \"link\") {\n        if (mouseType === 0) {\n          // left button to select\n          setSelected((prev) => prev.filter((i) => i != id).concat(id))\n        } else if (mouseType === 2) {\n          // right button to unselect\n          setSelected((prev) => prev.filter((i) => i != id))\n        }\n      } else if (editMode === \"move\") {\n        if (mouseType === 0) {\n          // left button to move\n          setSelected((prev) => (prev.length > 0 ? [] : [id]))\n        }\n      }\n    },\n    [editMode, setNodes, setSelected]\n  )\n\n  const onMouseUpPoint = useCallback((evt: any) => {}, [])\n\n  const guideLine = useMemo(\n    (): React.ReactElement => (\n      <>\n        {editMode === \"link\" && selectedNode && cursorPos && (\n          <Polyline\n            key={`edge-guide`}\n            path={[selectedNode, cursorPos].map(({ lat, lng }: NodeType) => ({\n              lat,\n              lng,\n            }))}\n            strokeWeight={3}\n            strokeColor=\"#db4040\"\n            strokeOpacity={1}\n            strokeStyle=\"dashed\"\n          />\n        )}\n      </>\n    ),\n    [editMode, selectedNode, cursorPos]\n  )\n\n  const NodePoints = useCallback((): React.ReactElement => {\n    const { level } = getMapBounds()\n    return (\n      <>\n        {bufNodes.map(\n          ({ key, lat, lng }: NodeType): React.ReactElement => (\n            <CustomOverlayMap\n              position={{\n                lat,\n                lng,\n              }}\n              key={key}\n            >\n              <Point\n                id={key}\n                color={graphColors.get(key)}\n                size={6 / level}\n                selected={isSelected(key)}\n                onMouseDown={onMouseDownPoint}\n                onMouseUp={onMouseUpPoint}\n              />\n            </CustomOverlayMap>\n          )\n        )}\n      </>\n    )\n  }, [\n    bufNodes,\n    graphColors,\n    getMapBounds,\n    isSelected,\n    onMouseDownPoint,\n    onMouseUpPoint,\n  ])\n\n  const EdgeLines = useCallback((): React.ReactElement => {\n    console.log(\"graph colors\", graphColors)\n    return (\n      <>\n        {visibleEdges.map(({ from, to }: EdgeType): React.ReactElement => {\n          const path: Array<any> = [from, to]\n            .map(getNode)\n            .filter((n) => n !== null)\n          if (path.length != 2) {\n            return <></>\n          }\n          return (\n            <Polyline\n              key={`edge-${from}-${to}`}\n              path={path.map(({ lat, lng }: NodeType) => ({\n                lat,\n                lng,\n              }))}\n              strokeWeight={3}\n              strokeColor={graphColors.get(from)}\n              strokeOpacity={1}\n              strokeStyle=\"solid\"\n            />\n          )\n        })}\n      </>\n    )\n  }, [visibleEdges, graphColors, getNode, isNodeVisible])\n\n  const fitMapBound = useCallback(\n    (nodes: NodeType[]) => {\n      if (nodes.length < 1) return\n      const bounds = new kakao.maps.LatLngBounds()\n      nodes.forEach(({ lat, lng }) => {\n        bounds.extend(new kakao.maps.LatLng(lat, lng))\n      })\n      map.setBounds(bounds)\n      setTimeout(() => {\n        map.relayout()\n      }, 0)\n    },\n    [map]\n  )\n\n  const loadGraphFromFile = useCallback(\n    (evt: React.ChangeEvent<HTMLInputElement>) => {\n      const files = evt.target.files\n      if (!files || files.length < 1) {\n        return\n      }\n      const file = files[0]\n      const reader: FileReader = new FileReader()\n      reader.addEventListener(\"load\", (event: any) => {\n        const result = event.target.result\n        try {\n          const { nodes, edges } = JSON.parse(result)\n          const newNodes: Array<NodeType> = nodes.map(\n            ({ id, lat, lng }: any) =>\n              ({\n                key: `node-${id}`,\n                lat,\n                lng,\n              } as NodeType)\n          )\n          setNodes(newNodes)\n          setEdges(\n            edges.map(\n              ({ from, to }: any) =>\n                ({\n                  from: (newNodes[from] as NodeType).key,\n                  to: (newNodes[to] as NodeType).key,\n                } as EdgeType)\n            )\n          )\n          fitMapBound(nodes)\n          // console.log(nodes, edges)\n        } catch {\n          window.alert(\"Failed to parse JSON\")\n        }\n      })\n      reader.readAsText(file)\n    },\n    [setNodes, setEdges]\n  )\n\n  const downloadGraphToFile = useCallback(\n    () => saveGraphFile(nodes, edges),\n    [nodes, edges]\n  )\n\n  return (\n    <>\n      <EdgeLines />\n      {guideLine}\n      <NodePoints />\n      <EditorButtons\n        editMode={editMode || \"add\"}\n        onClickDownload={downloadGraphToFile}\n        onClickUpload={loadGraphFromFile}\n        onModeChanged={setEditMode}\n      />\n    </>\n  )\n}\n\nexport default Editor\n","export const saveFile = (filename: string, blob: Blob) => {\n  const a = document.createElement(\"a\")\n  a.download = filename\n  a.href = URL.createObjectURL(blob)\n  a.dataset.downloadurl = [\"text/json\", a.download, a.href].join(\":\")\n  a.addEventListener(\"click\", (e) => {\n    setTimeout(() => URL.revokeObjectURL(a.href), 30 * 1000)\n  })\n  a.click()\n}\n\nexport const jsonToBlob = (json: object): Blob =>\n  new Blob([JSON.stringify(json, null, 2)], {\n    type: \"application/json\",\n  })\n","import React, { createContext, useState, useContext } from \"react\"\n\nexport interface ContextState<T> {\n  state: T\n  setState: React.Dispatch<React.SetStateAction<ControlState>>\n}\n\nexport interface ControlState {\n  mode: \"view\" | \"edit\"\n  viewSpeed?: number\n  viewRunning?: boolean\n}\n\nconst initialState: ControlState = {\n  mode: \"view\",\n  viewSpeed: 1.0,\n  viewRunning: false,\n}\n\nconst Context: any = createContext<ContextState<ControlState> | undefined>(\n  undefined\n)\n\nexport const ControlProvider = (props: any) => {\n  const [state, setState] = useState<ControlState>(initialState)\n\n  // const setContext = (state: ControlState) => {\n  //   setState((prevState: ControlState) => ({ ...prevState, ...state }))\n  // }\n\n  return (\n    <Context.Provider value={{ state: { ...state }, setState }}>\n      <>{props.children}</>\n    </Context.Provider>\n  )\n}\n\nexport const useControlState = (): [\n  ControlState,\n  React.Dispatch<React.SetStateAction<ControlState>>\n] => {\n  const ctx: ContextState<ControlState> | undefined = useContext(Context)\n  if (ctx === undefined) {\n    throw new Error(\"useControlState should be used within ControlProvider\")\n  }\n  const { state, setState } = ctx\n  return [\n    state as ControlState,\n    setState as React.Dispatch<React.SetStateAction<ControlState>>,\n  ]\n}\n","import React, { useState, useCallback } from \"react\"\n\nimport KakaoMap from \"../../components/KakaoMap\"\nimport HorizontalContainer from \"../../components/HorizontalContainer\"\nimport { Button } from \"@mui/joy\"\nimport Viewer from \"./Viewer\"\nimport Editor from \"./Editor\"\nimport CableIcon from \"@mui/icons-material/Cable\"\nimport LocalTaxiIcon from \"@mui/icons-material/LocalTaxi\"\nimport { useControlState, ControlState } from \"../../providers/ControlProvider\"\n\nimport \"./index.css\"\n\ntype SwitchButtonProps = React.PropsWithChildren & {\n  mode: \"view\" | \"edit\"\n  onChange: (mode: string) => void\n}\n\nconst SwitchButton = ({\n  mode,\n  onChange,\n}: SwitchButtonProps): React.ReactElement => (\n  <>\n    <Button\n      size=\"sm\"\n      startDecorator={<LocalTaxiIcon />}\n      variant={mode === \"view\" ? \"solid\" : \"plain\"}\n      onClick={() => onChange(\"view\")}\n      sx={{\n        borderTopRightRadius: 0,\n        borderBottomRightRadius: 0,\n      }}\n    >\n      Viewer\n    </Button>\n    <Button\n      size=\"sm\"\n      startDecorator={<CableIcon />}\n      variant={mode === \"edit\" ? \"solid\" : \"plain\"}\n      onClick={() => onChange(\"edit\")}\n      sx={{\n        borderTopLeftRadius: 0,\n        borderBottomLeftRadius: 0,\n      }}\n    >\n      Editor\n    </Button>\n  </>\n)\n\nexport default function Map() {\n  const [controls, setControls] = useControlState()\n\n  const latitude = 37.52897\n  const longitude = 126.917101\n  const [level, setLevel] = useState<number>(3)\n\n  const SwitchButtonControlled = useCallback(\n    (): React.ReactElement => (\n      <HorizontalContainer\n        position=\"top\"\n        gap={0}\n        style={{\n          padding: 0,\n          height: \"auto\",\n        }}\n      >\n        <SwitchButton\n          mode={controls.mode}\n          onChange={(mode: string) => {\n            setControls((prev) => ({ ...prev, mode } as ControlState))\n          }}\n        />\n      </HorizontalContainer>\n    ),\n    [(controls as ControlState).mode, setControls]\n  )\n\n  return (\n    <>\n      <KakaoMap\n        center={{\n          lat: latitude,\n          lng: longitude,\n        }}\n        level={level}\n        onZoomChanged={(map) => setLevel(map.getLevel())}\n        style={{\n          width: \"100%\",\n          height: \"100vh\",\n          zIndex: 0,\n        }}\n      >\n        <SwitchButtonControlled />\n        {controls.mode == \"view\" ? <Viewer /> : <Editor />}\n      </KakaoMap>\n    </>\n  )\n}\n","import React from \"react\"\nimport Map from \"./Map\"\nimport { ControlProvider } from \"../providers/ControlProvider\"\nimport { StatusProvider } from \"../providers/StatusProvider\"\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <StatusProvider>\n        <ControlProvider>\n          <Map />\n        </ControlProvider>\n      </StatusProvider>\n    </div>\n  )\n}\n\nexport default App\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\"\nimport ReactDOM from \"react-dom/client\"\nimport \"./index.css\"\nimport App from \"./pages/App\"\nimport reportWebVitals from \"./reportWebVitals\"\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\") as HTMLElement)\nroot.render(\n  // <React.StrictMode>\n  <App />\n  // </React.StrictMode>\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}